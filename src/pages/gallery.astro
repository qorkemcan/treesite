---
import MainLayout from '../layouts/MainLayout.astro';
import { SITE_CONFIG } from '../config.js';
import { Image } from 'astro:assets';

// T√ºm alt klas√∂rlerdeki g√∂rselleri √ßek
const allImagesGlob = import.meta.glob('../assets/gallery/fl/**/*.{jpeg,jpg,png,gif,webp}');
const imagePaths = Object.keys(allImagesGlob);

const galleryData = await Promise.all(
  imagePaths.map(async (path) => {
    const img: any = await allImagesGlob[path]();
    // Klas√∂r ismini path'den ayƒ±kla (removal, stump veya emergency)
    const category = path.includes('/removal/') ? 'removal' : 
                     path.includes('/stump/') ? 'stump' : 'emergency';
    return {
      src: img.default,
      category: category,
      path: path
    };
  })
);

// Kategorilere ayƒ±r
const removalImages = galleryData.filter(i => i.category === 'removal');
const stumpImages = galleryData.filter(i => i.category === 'stump');
const emergencyImages = galleryData.filter(i => i.category === 'emergency');

const categories = [
    { id: 'removal', name: 'Tree Removal', icon: 'üå≥', data: removalImages },
    { id: 'stump', name: 'Stump Grinding', icon: 'üèóÔ∏è', data: stumpImages },
    { id: 'emergency', name: 'Emergency Care', icon: 'üå™Ô∏è', data: emergencyImages }
];
---

<MainLayout 
  title="Professional Gallery | ProTreeTrim‚Ñ¢ Florida Work" 
  description="Explore our specialized galleries for tree removal, stump grinding, and emergency storm response across Florida."
>
  <header style="background: linear-gradient(135deg, #1b4332 0%, #081c15 100%); color: white; padding: 5rem 1.5rem; text-align: center; border-bottom: 6px solid #ea580c;">
    <h1 style="font-size: clamp(2.2rem, 8vw, 3.5rem); margin: 0; font-weight: 900; line-height: 1.1;">Work Gallery</h1>
    <p style="font-size: 1.2rem; color: #95d5b2; margin-top: 1.5rem; max-width: 800px; margin-left: auto; margin-right: auto;">
        High-performance solutions for Florida's most challenging tree projects.
    </p>
  </header>

  <main class="container" style="padding-top: 3rem; padding-bottom: 10rem;">
    
    <!-- MODER TAB NAVƒ∞GASYON -->
    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 4rem;">
        {categories.map(cat => (
            <button 
                class="tab-btn" 
                data-target={cat.id}
                style="background: white; border: 2px solid #e5e7eb; padding: 12px 25px; border-radius: 50px; cursor: pointer; font-weight: 800; color: #4b5563; display: flex; align-items: center; gap: 8px; transition: 0.3s;"
            >
                <span>{cat.icon}</span> {cat.name} ({cat.data.length})
            </button>
        ))}
    </div>

    <!-- GALERƒ∞ KATEGORƒ∞LERƒ∞ -->
    {categories.map(cat => (
        <section id={cat.id} class="gallery-section" style="display: none;">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                {cat.data.map((img, index) => (
                    <div class={`img-card ${index >= 8 ? 'hidden-img' : ''}`} style="overflow: hidden; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); aspect-ratio: 1/1; background: #eee;">
                        <Image 
                            src={img.src} 
                            alt={`Florida ${cat.name} service project`} 
                            width={500} 
                            height={500} 
                            format="webp"
                            style="width: 100%; height: 100%; object-fit: cover;"
                            class="hover-zoom"
                        />
                    </div>
                ))}
            </div>
            
            {cat.data.length > 8 && (
                <div style="text-align: center; margin-top: 4rem;">
                    <button class="load-more-btn" style="background: #1b4332; color: white; border: none; padding: 15px 40px; border-radius: 12px; font-weight: 800; cursor: pointer;">
                        VIEW ALL {cat.name.toUpperCase()} IMAGES
                    </button>
                </div>
            )}
        </section>
    ))}

    <!-- Alt CTA -->
    <div style="margin-top: 8rem; background: #f0fdf4; padding: 4rem 2rem; border-radius: 40px; text-align: center; border: 2px dashed #166534;">
        <h2 style="color: #064e3b; font-size: 2.2rem; font-weight: 900; margin-top: 0;">Get Results Like These</h2>
        <p style="color: #166534; font-size: 1.2rem; margin-bottom: 2.5rem; max-width: 600px; margin-left: auto; margin-right: auto;">Connect with the elite crews featured in our gallery for your property today.</p>
        <a href={SITE_CONFIG.phoneHref} style="background: #ea580c; color: white !important; padding: 1.4rem 3rem; text-decoration: none; border-radius: 18px; font-weight: 900; font-size: 1.5rem; display: inline-block; box-shadow: 0 10px 25px rgba(234, 88, 12, 0.3);">
            CALL FOR A FREE QUOTE
        </a>
    </div>
  </main>
</MainLayout>

<style>
  .tab-btn.active {
      background: #1b4332 !important;
      color: white !important;
      border-color: #1b4332 !important;
      box-shadow: 0 10px 20px rgba(27, 67, 50, 0.2);
  }
  
  .hover-zoom {
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .img-card:hover .hover-zoom {
      transform: scale(1.1);
  }

  .hidden-img {
      display: none;
  }
</style>

<script is:inline>
    const buttons = document.querySelectorAll('.tab-btn');
    const sections = document.querySelectorAll('.gallery-section');

    function switchTab(id) {
        buttons.forEach(btn => {
            if(btn.getAttribute('data-target') === id) btn.classList.add('active');
            else btn.classList.remove('active');
        });
        sections.forEach(sec => {
            if(sec.id === id) sec.style.display = 'block';
            else sec.style.display = 'none';
        });
    }

    // ƒ∞lk a√ßƒ±lƒ±≈üta Removal kategorisini g√∂ster
    switchTab('removal');

    buttons.forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.getAttribute('data-target')));
    });

    // "View All" butonu √ßalƒ±≈ümasƒ±
    document.querySelectorAll('.load-more-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const section = this.closest('.gallery-section');
            section.querySelectorAll('.hidden-img').forEach(img => {
                img.classList.remove('hidden-img');
            });
            this.style.display = 'none'; // Butonu gizle
        });
    });
</script>